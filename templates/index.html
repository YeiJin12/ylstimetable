{% extends 'base.html' %}
{% load custom_tags %}
{% block content %}
<br>
<div class="container">
    {% if messages %}
    <div class = "alert alert-danger my-3" role="alert">
        {% for message in messages %}
            <strong>{{ message.tags }}</strong>
            <ul><li>{{ message.message }}</li></ul>
        {% endfor %}
    </div>
    {% endif %}
    <div class="row">
        <div class="col-xs-12 col-md-8">
            <div class="searchbar">
                <form method="POST" action="{% url 'timetable:result' %}">
                    {% csrf_token %}
                <input id="search" type="text" name="classname" placeholder="검색어를 입력해 주세요.">
                <button id="searchbutton" type="submit">
                    <i class="fas fa-search fa-lg"></i>
                </button>
                </form>
            </div>
            <div class="containers">
                <a class="btnn" id="contents">직접 추가</a>
                <div id="popup">
                    <div id="popmenu">
                        <form method="POST" action="{% url 'timetable:manual' %}">
                        {% csrf_token %}
                        <input id="inputclass" type="text" name="title" placeholder="수업명" size="20">
                        <input class="my-2" type="text" name="time" placeholder="시간 ex)화5,6,수5" size="20">
                        <br>
                        <button type="submit" class="btn btn-primary">등록</button>
                        </form>
                        <div class="exit">닫기</div>
                    </div>
                </div>
            </div>
            <table class="table table-bordered">
                <tbody>
                <tr class="text-center">
                    <th width="5%"></th>
                    <th width="15.6%"><span style = "font-size:12px; font-weight:lighter;">월</span></th>
                    <th width="15.6%"><span style = "font-size:12px; font-weight:lighter;">화</span></th>
                    <th width="15.6%"><span style = "font-size:12px; font-weight:lighter;">수</span></th>
                    <th width="15.6%"><span style = "font-size:12px; font-weight:lighter;">목</span></th>
                    <th width="15.6%"><span style = "font-size:12px; font-weight:lighter;">금</span></th>
                    {% if saturday == 1 %}
                    <th width="15.6%"><span style = "font-size:12px; font-weight:lighter;">토</span></th>
                    {% endif %}
                </tr>
                {% for i in ran %}
                <tr>
                    {% time i as p %}
                    <th class="text-center align-middle"><p style = "font-size:12px; font-weight:lighter;">{{ p }}</p></th>
                    {% for j in rang %}
                    {% add_str i j as cou %}
                    {% if cou in tabletime %}
                    {% subst cou as couu %}
                    {% location tabletime cou as loca %}
                    {% content tablename loca as title %}
                    {% content tablecolor loca as color %}
                    {% if couu in tabletime %}
                    {% location tabletime couu as locaa %}
                    {% content tablecolor locaa as colorsub %}
                    {% else %}
                    {% subst color as colorsub %}
                    {% endif %}
                    {% content tableroom loca as room %}
                        {% if color == 1 %}
                        <th bgcolor="CFE2F8">
                            {% if color != colorsub %}
                            <span style = "font-size:12px;">{{ title }}</span><br>
                            <span style = "font-size:12px; font-weight:lighter;">{{ room }}</span>
                            {% endif %}
                        </th>
                        {% endif %}
                        {% if color == 2 %}
                        <th bgcolor="F8CFD2">
                            {% if color != colorsub %}
                            <span style = "font-size:12px;">{{ title }}</span><br>
                            <span style = "font-size:12px; font-weight:lighter;">{{ room }}</span>
                            {% endif %}
                        </th>
                        {% endif %}
                        {% if color == 3 %}
                        <th bgcolor="DAF8CF">
                            {% if color != colorsub %}
                            <span style = "font-size:12px;">{{ title }}</span><br>
                            <span style = "font-size:12px; font-weight:lighter;">{{ room }}</span>
                            {% endif %}
                        </th>
                        {% endif %}
                        {% if color == 4 %}
                        <th bgcolor="F4CFF8">
                            {% if color != colorsub %}
                            <span style = "font-size:12px;">{{ title }}</span><br>
                            <span style = "font-size:12px; font-weight:lighter;">{{ room }}</span>
                            {% endif %}
                        </th>
                        {% endif %}
                        {% if color == 5 %}
                        <th bgcolor="F7F8CF">
                            {% if color != colorsub %}
                            <span style = "font-size:12px;">{{ title }}</span><br>
                            <span style = "font-size:12px; font-weight:lighter;">{{ room }}</span>
                            {% endif %}
                        </th>
                        {% endif %}
                        {% if color == 6 %}
                        <th bgcolor="CFF8F6">
                            {% if color != colorsub %}
                            <span style = "font-size:12px;">{{ title }}</span><br>
                            <span style = "font-size:12px; font-weight:lighter;">{{ room }}</span>
                            {% endif %}
                        </th>
                        {% endif %}
                        {% if color == 7 %}
                        <th bgcolor="F8DECF">
                            {% if color != colorsub %}
                            <span style = "font-size:12px;">{{ title }}</span><br>
                            <span style = "font-size:12px; font-weight:lighter;">{{ room }}</span>
                            {% endif %}
                        </th>
                        {% endif %}
                        {% if color == 8 %}
                        <th bgcolor="F0CFF8">
                            {% if color != colorsub %}
                            <span style = "font-size:12px;">{{ title }}</span><br>
                            <span style = "font-size:12px; font-weight:lighter;">{{ room }}</span>
                            {% endif %}
                        </th>
                        {% endif %}
                        {% else %}
                        <th></th>
                        {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
                </tbody>
            </table>

        </div>

        <!-- 시간표 -->
        <div class="col-xs-12 col-md-4">
            2021학년도 1학기 <br>신청학점: {{ credit }}
            {% if tabletime %}
                <table id="classmenu" class="table table-hover">
                    <tbody>
                    {% for i in list %}
                    <tr>
                        <td>
                            <p class="title" style="font-weight: bold">{{ i.title }}</p>
                            <p class="prof">{{ i.professor }}/ {{ i.room }}</p>
                            <div class="reg">
                                <form id="forminline" method="POST" action="{% url 'timetable:delete' i.id %}">
                                {% csrf_token %}
                                <button type="submit" class="btnnb">삭제</button>
                                </form>
                                <a class="btnnn" href="{% url 'timetable:address' i.number i.ban %}">실라버스</a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% endif %}
            <br>
            {% if listm %}
            <table class="table-sm table-striped table-condensed">
                <tbody>
                <tr class="text-center">
                    <th style="width: 50%">일정</th>
                    <th></th>
                </tr>
                {% for i in listm %}
                <tr class = "text-center" height="30px">
                    <td><p style = "font-size:14px;">{{ i.title }}</p></td>
                    <td><h6>
                        <form method="POST" action="{% url 'timetable:manual_delete' i.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-primary">삭제</button>
                        </form>
                    </h6></td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}

{% block script %}
<script type='text/javascript'>
$(document).ready(function() {
        $("#contents").click(function() {
            $("#popup").fadeIn();
        });
        $(".exit").click(function() {
            $("#popup").fadeOut();
        });
    });

$(function(){
  $('table tbody td').mouseenter(function(){
    $(this).find('.reg').show();
  });
  $('table tbody td').mouseleave(function(){
    $(this).find('.reg').hide();
  });
});
</script>
{% endblock %}
